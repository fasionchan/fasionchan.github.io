---
layout: post
title: "HTTP压力测试潜在问题若干"
date: 2015-03-27 16:56:02 +0800
comments: true
categories: 
---

首先，用`ulimit -n`看看是不是文件描述符设置过小而被打满：发现设置值是`65536`，这是`10000`个并发不可能用满的。当然，大部分服务器上都是采用默认配置`1024`，这时就是罪魁祸首了。

## backlog太小

各种可能的原因都查了查了，最后发现是由于底层套接字调用`listen`时`backlog`参数太小造成的！`listen`系统调用的作用是使TCP套接字进行监听状态，`backlog`是内核维持请求连接队列的个数限制（不包括已经被accept的连接）。我要测试的WEB接口是用基于`tornado`框架的，绑定端口时`backlog`默认参数是`128`，很快就被`10000`个请求给压满了，这就是`ab`各种超时的主要原因！调大这个参数后问题就解决了~
